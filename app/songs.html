<!DOCTYPE html>

<html>
<head>

<link rel="stylesheet" href="../vendor/bootstrap3.3.4/css/bootstrap.min.css">
<link rel="stylesheet" href="css/index.css">
<link rel="stylesheet" href="css/songs.css">
<link href='http://fonts.googleapis.com/css?family=IM+Fell+DW+Pica' rel='stylesheet' type='text/css'>

<script src="../vendor/jquery/jquery-1.11.2.min.js"></script>
<script src="../vendor/bootstrap3.3.4/js/bootstrap.min.js"></script>
<script src="../vendor/typeahead.js"></script>
<script src="../vendor/fuse.js"></script>

<script>
$(function(){
  $("#search-text").keypress(function(e){
    if(e.keyCode == 13){
      search($('#search-text').val());
    }
  });

  $('.typeahead').bind('typeahead:select', function(ev, suggestion) {
    search($('#search-text').val());
  });    



  var substringMatcher = function(strs) {
    return function findMatches(q, cb) {
      if(q==''){
        return cb(['What is Love - Haddaway', 'Fifteen - Taylor Swift', 'Take Me To Church - Hozier']);
      }

      var matches, substringRegex;
   
      // an array that will be populated with substring matches
      matches = [];
   
      // regex used to determine if a string contains the substring `q`
      substrRegex = new RegExp(q, 'i');
   
      // iterate through the pool of strings and for any string that
      // contains the substring `q`, add it to the `matches` array
      $.each(strs, function(i, str) {
        if (substrRegex.test(str)) {
          matches.push(str);
        }
      });
   
      cb(matches);
    };
  };
   
  Songs = [];

  $.get('text/songs.txt', function(data) {
    songs = data.split('\n');
    for(i = 0; i<songs.length; i++){
      Songs.push({id: i, title: songs[i].split(' - ')[0], artist: songs[i].split(' - ')[1]});
    }
    setup_typeahead();
  });

  setup_typeahead = function(){
     
    $('#search-text').typeahead({
      hint: true,
      highlight: true,
      minLength: 0
    },
    {
      name: 'songs',
      source: substringMatcher(songs)
    });

  };

  var options = {
    keys: ['artist', 'title'],   // keys to search in
    maxPatternLength: 200
  }

  f = new Fuse(Songs, options);

  search = function(query){
    results = f.search(query)

    $('#search-results').html('');

    for(i = 0; i<results.length; i++){
      console.log(results[i]);
      var search_result = $('<a>').attr('href', 'karaoke.html').attr('class', 'list-group-item').text(results[i].title + " - " + results[i].artist);
      console.log(search_result);
      $('#search-results').append(search_result);
    }

    $('#search-results').show();
  };

});
</script>

</head>

<body>

<nav id="navigation" class="navbar navbar-default">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Singing Simply</a>
    </div>

    <ul class="nav navbar-nav">
      <li><a href="start.html">Getting started</a></li>
      <li><a href="exercises.html">Exercises</a></li>
      <li class='active'><a href="songs.html">Songs</a></li>
      <li><a href="progress.html">My Progress</a></li>
    </ul>

    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Joe Schmoe <span class="caret"></span></a>
        <ul class="dropdown-menu" role="menu">
          <li><a href="#">Sign out</a></li>
        </ul>
      </li>
    </ul>
    </div><!-- /.navbar-collapse -->
  </div>
</nav>

<div class="container songs-container">  
  <div class="row">
    <div class='col-xs-12'>
      <h1 class="text-center">Select a song</h1>
      <div class="input-group" style="padding-left: 20px; padding-right: 20px;">
        <form id='search-form'>
          <input id='search-text' type="text" class="typeahead form-control" placeholder="Name of the songs, singers, bands...">
        </form>
      </div><!-- /input-group -->
      <div id='search-results' class='list-group' style='display: none;'>
        <a href="karaoke.html" class="list-group-item">Haddaway - What is love <div style='float:right;'>04:31</div></a>
        <a href="karaoke.html" class="list-group-item">Justin Bieber - Baby <div style='float:right;'>03:45</div></a>
        <a href="karaoke.html" class="list-group-item">Hozier - Take Me To Church <div style='float:right;'>04:11</div></a>
        <a href="karaoke.html" class="list-group-item">Pink Floyd - Absolutely Curtains <div style='float:right;'>05:52</div></a>
        <a href="karaoke.html" class="list-group-item">Pink Floyd - Coming Back to Life <div style='float:right;'>06:19</div></a>
        <a href="karaoke.html" class="list-group-item">Pink Floyd - The Dogs of War <div style='float:right;'>06:05</div></a>
        <a href="karaoke.html" class="list-group-item">Pink Floyd - Dramatic Theme <div style='float:right;'>02:15</div></a>
        <a href="karaoke.html" class="list-group-item">Pink Floyd - Empty Spaces <div style='float:right;'>02:10</div></a>
        <!-- search results -->
      </div>
    </div>
  </div>
</div>

</body>

</html>
